<head>
  <style>
    .blend {
      background-size: cover;
      background-blend-mode: darken;
    }
  </style>
  <% include partials/head %>
</head>
<body>

  <% include partials/google-analytics %>
	<% include partials/facebook %>
	<% include partials/header %>

  <div class="plax content">

    <div class="container" style="padding-top: 50px;">

      <% include partials/publicidad-top %>
    </div>
  </div>
  <div id="bigpicture" class="crt-parallaxvideo">
  </div>
  <div class="plax content">

    <div class="container" >

      <div class="row">

        <div class="col-md-9">

          <div class="row">

            <div class=" col-md-12">

            <% if (!player) { %>
              <div class="alert alert-danger" role="alert">No existe este jugador en nuestros registros</div>
            <% } else { %>

              <div class="panel panel-primary">

                <div class="panel-heading"><%= player.personaname %></div>

                <div class="panel-body" >

                </div>
              </div>

              <% if(player && player.twitch){ %>
              <div class="panel panel-twitch">

                <div class="panel-heading"><img src="/img/social/twitch.png" width="16"> Twitch </div>

                <div id="twitch_banner" class="panel-body blend" style="color:white;">

                  <a href="http://twitch.tv/<%= player.twitch.name %>">
                    <div class="col-md-2"><img id="twitch_logo" height=64 width=64 class="img-thumbnail"></div>
                  </a>

                  <div class="col-md-9">

                    <a href="http://twitch.tv/<%= player.twitch.name %>"><h2 id="twitch_name"></h2></a>

                    <p>
                      <span class="glyphicon glyphicon-eye-open" aria-hidden="true"></span> <span id="twitch_views"></span>
                      <span class="glyphicon glyphicon-heart-empty" aria-hidden="true"></span> <span id="twitch_followers"></span>
                    </p>

                    <p><%= player.twitch.bio %></p>

                  </div>
                </div>
              </div>
              <% }%>
            <% }%>
            </div>
          </div>
        </div>

        <% include partials/sidebar %>

      </div>
    </div>
  </div>

  <% include partials/footer %>
  <% include partials/bootstrapjs %>
  <% if(player&&player.twitch){ %>

  <script>
    var xmlhttpuno = new XMLHttpRequest();
    var urlTwitchChannel = "https://api.twitch.tv/kraken/channels/<%= player.twitch.name %>";
    xmlhttpuno.onreadystatechange = function() {
      if (xmlhttpuno.readyState == 4 && xmlhttpuno.status == 200) {
        var channelInfo = JSON.parse(xmlhttpuno.responseText);
        document.getElementById("twitch_name").innerHTML = channelInfo.name;
        document.getElementById("twitch_views").innerHTML = channelInfo.views;
        document.getElementById("twitch_followers").innerHTML = channelInfo.followers;
        document.getElementById("twitch_banner").style.background = " linear-gradient(to bottom, rgba(100, 65, 165,0.9), rgba(38, 38, 38,0.9)), url('"+channelInfo.profile_banner+"') no-repeat";
        document.getElementById("twitch_banner").style.backgroundSize = "cover";
        document.getElementById("twitch_logo").src = channelInfo.logo;
      }
    };
    xmlhttpuno.open("GET", urlTwitchChannel, true);
    xmlhttpuno.send();

    // Twitch-API
    // GET https://api.twitch.tv/kraken/streams/:player.twitch.name
    // If user is streaming now, the page will show her stream with chat.
    var xmlhttp2 = new XMLHttpRequest();
    var urlTwitchStream = "https://api.twitch.tv/kraken/streams/<%= player.twitch.name %>";
    xmlhttp2.onreadystatechange = function() {
      if (xmlhttp2.readyState == 4 && xmlhttp2.status == 200) {
        var streamInfo = JSON.parse(xmlhttp2.responseText);
        if(streamInfo.stream != null){
          document.getElementById("bigpicture").innerHTML = '<iframe id="stream" frameborder="0" scrolling="no" height="560" style="min-width: 100%;background-color :black;z-index: -100;"></iframe>';
          document.getElementById("stream").setAttribute("src","https://player.twitch.tv/?channel=<%= player.twitch.name %>");
        }else{
          document.getElementById("bigpicture").className = 'plax ccparallax';
          document.getElementById("bigpicture").style.backgroundImage = "url('<%= player.avatar %>')";
          document.getElementById("bigpicture").innerHTML = '<div class="container"><h1><%= player.personaname %></h1></div>';
        }
      }
    };
    xmlhttp2.open("GET", urlTwitchStream, true);
    xmlhttp2.send();


  </script>
  <% } %>
  <% if(player&&!player.twitch){ %>
    <script>
    document.getElementById("bigpicture").className = 'plax ccparallax';
    document.getElementById("bigpicture").style.backgroundImage = "url('<%= player.avatar %>')";
    document.getElementById("bigpicture").innerHTML = '<div class="container"><h1><%= player.personaname %></h1></div>';
    </script>
  <% } %>
  <% if(!player){ %>
    <script>
    document.getElementById("bigpicture").className = 'plax ccparallax';
    document.getElementById("bigpicture").style.backgroundImage = "url('/img/riki.jpg')";
    document.getElementById("bigpicture").innerHTML = '<div class="container"><h1>not found</h1></div>';
    </script>
  <% } %>
</body>
